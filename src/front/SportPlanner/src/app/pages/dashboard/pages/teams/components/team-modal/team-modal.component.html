@if (isOpen) {
  <!-- Modal Backdrop -->
  <div 
    class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"
    (click)="onBackdropClick($event)"
    (keydown.escape)="onClose()"
    tabindex="0"
    role="dialog"
    [attr.aria-modal]="true"
    [attr.aria-labelledby]="'modal-title'"
  >
    <!-- Modal Container -->
    <div class="bg-card rounded-xl shadow-2xl max-w-md w-full max-h-[90vh] flex flex-col ring-1 ring-border">
      <!-- Modal Header -->
      <div class="flex items-center justify-between p-6 border-b border-border">
        <h2 id="modal-title" class="text-xl font-semibold text-foreground">
          {{ modalTitle() }}
        </h2>
        <button
          (click)="onClose()"
          [disabled]="isSubmitting()"
          class="p-2 rounded-lg hover:bg-secondary/50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"
          type="button"
        >
          <ng-icon name="heroXMark" class="w-5 h-5 text-muted-foreground" />
        </button>
      </div>

      <!-- Modal Body -->
      <div class="flex-1 p-6 overflow-y-auto">
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="space-y-4">
          <!-- Team Name -->
          <div>
            <label for="name" class="block text-sm font-medium text-foreground mb-1">
              Nombre del Equipo *
            </label>
            <input
              id="name"
              type="text"
              formControlName="name"
              placeholder="Ej: Juvenil A, Cadete Femenino..."
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-background border-border text-foreground placeholder-muted-foreground"
              [class.border-red-500]="isFieldInvalid('name')"
            >
            @if (isFieldInvalid('name')) {
              <p class="mt-1 text-sm text-red-600">
                {{ getFieldError('name') }}
              </p>
            }
          </div>

          <!-- Category -->
          <div>
            <label for="category" class="block text-sm font-medium text-foreground mb-1">
              Categoría *
            </label>
            <select
              id="categoryId"
              formControlName="categoryId"
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-background border-border text-foreground"
              [class.border-red-500]="isFieldInvalid('categoryId')"
            >
              <option value="">Seleccionar categoría</option>
              @for (category of categoryOptions(); track category.id) {
                <option [value]="category.id">{{ category.name }}</option>
              }
            </select>
            @if (isFieldInvalid('category')) {
              <p class="mt-1 text-sm text-red-600">
                {{ getFieldError('category') }}
              </p>
            }
          </div>

          <!-- Gender -->
          <div>
            <label for="gender" class="block text-sm font-medium text-foreground mb-1">
              Género *
            </label>
            <select
              id="sportGenderId"
              formControlName="sportGenderId"
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-background border-border text-foreground"
              [class.border-red-500]="isFieldInvalid('sportGenderId')"
            >
              <option value="">Seleccionar género</option>
              @for (gender of sportGenderOptions(); track gender.id) {
                <option [value]="gender.id">{{ gender.name }}</option>
              }
            </select>
            @if (isFieldInvalid('gender')) {
              <p class="mt-1 text-sm text-red-600">
                {{ getFieldError('gender') }}
              </p>
            }
          </div>

          <!-- Level -->
          <div>
            <label for="level" class="block text-sm font-medium text-foreground mb-1">
              Nivel *
            </label>
            <select
              id="levelId"
              formControlName="levelId"
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-background border-border text-foreground"
              [class.border-red-500]="isFieldInvalid('levelId')"
            >
              <option value="">Seleccionar nivel</option>
              @for (level of levelOptions(); track level.id) {
                <option [value]="level.id">{{ level.name }}</option>
              }
            </select>
            @if (isFieldInvalid('level')) {
              <p class="mt-1 text-sm text-red-600">
                {{ getFieldError('level') }}
              </p>
            }
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-medium text-foreground mb-1">
              Descripción
            </label>
            <textarea
              id="description"
              formControlName="description"
              rows="3"
              placeholder="Descripción opcional del equipo..."
              class="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:border-green-500 bg-background border-border text-foreground placeholder-muted-foreground resize-none"
              [class.border-red-500]="isFieldInvalid('description')"
            ></textarea>
            @if (isFieldInvalid('description')) {
              <p class="mt-1 text-sm text-red-600">
                {{ getFieldError('description') }}
              </p>
            }
          </div>
        </form>
      </div>

      <!-- Modal Footer -->
      <div class="flex items-center justify-end space-x-3 p-6 border-t border-border bg-secondary/30">
        <button
          type="button"
          (click)="onClose()"
          [disabled]="isSubmitting()"
          class="px-4 py-2 text-sm font-medium text-foreground bg-card border border-border rounded-lg hover:bg-secondary/50 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed cursor-pointer"
        >
          Cancelar
        </button>
        <button
          type="submit"
          (click)="onSubmit()"
          [disabled]="isSubmitting() || form.invalid"
          class="px-4 py-2 text-sm font-medium text-white bg-green-600 hover:bg-green-700 disabled:bg-green-400 disabled:cursor-not-allowed rounded-lg transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 focus:ring-offset-background cursor-pointer"
        >
          @if (isSubmitting()) {
            <span class="flex items-center">
              <ng-icon name="heroArrowPath" class="w-4 h-4 mr-2 animate-spin" />
              {{ submitButtonText() }}
            </span>
          } @else {
            {{ submitButtonText() }}
          }
        </button>
      </div>
    </div>
  </div>
}