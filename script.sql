Build started...
Build succeeded.
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;
CREATE TABLE "Users" (
    "SupabaseId" text NOT NULL,
    "Email" text,
    "Name" text,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Users" PRIMARY KEY ("SupabaseId")
);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251115222954_InitialCreate', '9.0.0');

CREATE TABLE "Organizations" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "OwnerSupabaseId" text,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Organizations" PRIMARY KEY ("Id")
);

CREATE TABLE "Sports" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Slug" text,
    "Description" text,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Sports" PRIMARY KEY ("Id")
);

CREATE TABLE "SubscriptionPlans" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Level" integer NOT NULL,
    "Price" numeric NOT NULL,
    "MaxTeams" integer,
    "MaxMembersPerTeam" integer,
    "Features" text,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_SubscriptionPlans" PRIMARY KEY ("Id")
);

CREATE TABLE "OrganizationMemberships" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "OrganizationId" integer NOT NULL,
    "UserSupabaseId" text NOT NULL,
    "Role" integer NOT NULL,
    "JoinedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_OrganizationMemberships" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_OrganizationMemberships_Organizations_OrganizationId" FOREIGN KEY ("OrganizationId") REFERENCES "Organizations" ("Id") ON DELETE CASCADE
);

CREATE TABLE "Subscriptions" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "UserSupabaseId" text,
    "OrganizationId" integer,
    "PlanId" integer NOT NULL,
    "SportId" integer NOT NULL,
    "StartDate" timestamp with time zone NOT NULL,
    "EndDate" timestamp with time zone,
    "IsActive" boolean NOT NULL,
    "Status" integer NOT NULL,
    "AutoRenew" boolean NOT NULL,
    "NextBillingDate" timestamp with time zone,
    "CancelledAt" timestamp with time zone,
    "RetentionEndsAt" timestamp with time zone,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Subscriptions" PRIMARY KEY ("Id"),
    CONSTRAINT "CK_Subscription_UserOrOrg" CHECK (("UserSupabaseId" IS NOT NULL) != ("OrganizationId" IS NOT NULL)),
    CONSTRAINT "FK_Subscriptions_Organizations_OrganizationId" FOREIGN KEY ("OrganizationId") REFERENCES "Organizations" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_Subscriptions_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_Subscriptions_SubscriptionPlans_PlanId" FOREIGN KEY ("PlanId") REFERENCES "SubscriptionPlans" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_Subscriptions_Users_UserSupabaseId" FOREIGN KEY ("UserSupabaseId") REFERENCES "Users" ("SupabaseId") ON DELETE CASCADE
);

CREATE TABLE "SubscriptionHistories" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "SubscriptionId" integer NOT NULL,
    "OldPlanId" integer,
    "NewPlanId" integer,
    "ChangeType" integer NOT NULL,
    "RequestedAt" timestamp with time zone NOT NULL,
    "EffectiveAt" timestamp with time zone NOT NULL,
    "ChangedByUserSupabaseId" text,
    "Note" text,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_SubscriptionHistories" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SubscriptionHistories_Subscriptions_SubscriptionId" FOREIGN KEY ("SubscriptionId") REFERENCES "Subscriptions" ("Id") ON DELETE CASCADE
);

CREATE TABLE "Teams" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "OwnerUserSupabaseId" text,
    "OrganizationId" integer,
    "SubscriptionId" integer,
    "SportId" integer,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Teams" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Teams_Organizations_OrganizationId" FOREIGN KEY ("OrganizationId") REFERENCES "Organizations" ("Id"),
    CONSTRAINT "FK_Teams_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id"),
    CONSTRAINT "FK_Teams_Subscriptions_SubscriptionId" FOREIGN KEY ("SubscriptionId") REFERENCES "Subscriptions" ("Id")
);

CREATE TABLE "TeamMembers" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TeamId" integer NOT NULL,
    "UserSupabaseId" text NOT NULL,
    "Role" integer NOT NULL,
    "JoinedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_TeamMembers" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TeamMembers_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE
);

CREATE UNIQUE INDEX "IX_OrganizationMemberships_OrganizationId_UserSupabaseId" ON "OrganizationMemberships" ("OrganizationId", "UserSupabaseId");

CREATE UNIQUE INDEX "IX_Sports_Name" ON "Sports" ("Name");

CREATE INDEX "IX_SubscriptionHistories_SubscriptionId" ON "SubscriptionHistories" ("SubscriptionId");

CREATE UNIQUE INDEX "IX_Subscription_Org_Sport_Active" ON "Subscriptions" ("OrganizationId", "SportId") WHERE "IsActive" = TRUE AND "OrganizationId" IS NOT NULL;

CREATE UNIQUE INDEX "IX_Subscription_User_Sport_Active" ON "Subscriptions" ("UserSupabaseId", "SportId") WHERE "IsActive" = TRUE AND "UserSupabaseId" IS NOT NULL;

CREATE INDEX "IX_Subscriptions_PlanId" ON "Subscriptions" ("PlanId");

CREATE INDEX "IX_Subscriptions_SportId" ON "Subscriptions" ("SportId");

CREATE UNIQUE INDEX "IX_TeamMembers_TeamId_UserSupabaseId" ON "TeamMembers" ("TeamId", "UserSupabaseId");

CREATE INDEX "IX_Teams_OrganizationId" ON "Teams" ("OrganizationId");

CREATE INDEX "IX_Teams_SportId" ON "Teams" ("SportId");

CREATE INDEX "IX_Teams_SubscriptionId" ON "Teams" ("SubscriptionId");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251115232518_AddSubscriptions', '9.0.0');

CREATE TABLE "ConceptCategories" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_ConceptCategories" PRIMARY KEY ("Id")
);

CREATE TABLE "ConceptPhases" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_ConceptPhases" PRIMARY KEY ("Id")
);

CREATE TABLE "Courts" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Location" text,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_Courts" PRIMARY KEY ("Id")
);

CREATE TABLE "DifficultyLevels" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Rank" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_DifficultyLevels" PRIMARY KEY ("Id")
);

CREATE TABLE "TrainingSchedules" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text,
    "TeamId" integer NOT NULL,
    "StartDate" timestamp with time zone NOT NULL,
    "EndDate" timestamp with time zone NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_TrainingSchedules" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TrainingSchedules_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE
);

CREATE TABLE "SportConcepts" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "ConceptCategoryId" integer,
    "ConceptPhaseId" integer,
    "DifficultyLevelId" integer,
    "ProgressWeight" integer NOT NULL,
    "IsProgressive" boolean NOT NULL,
    "SportId" integer,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_SportConcepts" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SportConcepts_ConceptCategories_ConceptCategoryId" FOREIGN KEY ("ConceptCategoryId") REFERENCES "ConceptCategories" ("Id"),
    CONSTRAINT "FK_SportConcepts_ConceptPhases_ConceptPhaseId" FOREIGN KEY ("ConceptPhaseId") REFERENCES "ConceptPhases" ("Id"),
    CONSTRAINT "FK_SportConcepts_DifficultyLevels_DifficultyLevelId" FOREIGN KEY ("DifficultyLevelId") REFERENCES "DifficultyLevels" ("Id"),
    CONSTRAINT "FK_SportConcepts_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id")
);

CREATE TABLE "TrainingScheduleDays" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TrainingScheduleId" integer NOT NULL,
    "DayOfWeek" integer NOT NULL,
    "StartTime" interval NOT NULL,
    "EndTime" interval,
    "CourtId" integer,
    CONSTRAINT "PK_TrainingScheduleDays" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TrainingScheduleDays_Courts_CourtId" FOREIGN KEY ("CourtId") REFERENCES "Courts" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_TrainingScheduleDays_TrainingSchedules_TrainingScheduleId" FOREIGN KEY ("TrainingScheduleId") REFERENCES "TrainingSchedules" ("Id") ON DELETE CASCADE
);

CREATE TABLE "TrainingSessions" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TrainingScheduleId" integer,
    "StartAt" timestamp with time zone NOT NULL,
    "Duration" interval NOT NULL,
    "CourtId" integer,
    CONSTRAINT "PK_TrainingSessions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TrainingSessions_Courts_CourtId" FOREIGN KEY ("CourtId") REFERENCES "Courts" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_TrainingSessions_TrainingSchedules_TrainingScheduleId" FOREIGN KEY ("TrainingScheduleId") REFERENCES "TrainingSchedules" ("Id") ON DELETE SET NULL
);

CREATE TABLE "PlanConcepts" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TrainingScheduleId" integer NOT NULL,
    "SportConceptId" integer NOT NULL,
    CONSTRAINT "PK_PlanConcepts" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_PlanConcepts_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_PlanConcepts_TrainingSchedules_TrainingScheduleId" FOREIGN KEY ("TrainingScheduleId") REFERENCES "TrainingSchedules" ("Id") ON DELETE CASCADE
);

CREATE TABLE "SessionConcepts" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TrainingSessionId" integer NOT NULL,
    "SportConceptId" integer NOT NULL,
    "Order" integer NOT NULL,
    "PlannedDurationMinutes" integer,
    "Notes" text,
    "PlanConceptId" integer,
    CONSTRAINT "PK_SessionConcepts" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_SessionConcepts_PlanConcepts_PlanConceptId" FOREIGN KEY ("PlanConceptId") REFERENCES "PlanConcepts" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_SessionConcepts_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_SessionConcepts_TrainingSessions_TrainingSessionId" FOREIGN KEY ("TrainingSessionId") REFERENCES "TrainingSessions" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_PlanConcepts_SportConceptId" ON "PlanConcepts" ("SportConceptId");

CREATE UNIQUE INDEX "IX_PlanConcepts_TrainingScheduleId_SportConceptId" ON "PlanConcepts" ("TrainingScheduleId", "SportConceptId");

CREATE INDEX "IX_SessionConcepts_PlanConceptId" ON "SessionConcepts" ("PlanConceptId");

CREATE INDEX "IX_SessionConcepts_SportConceptId" ON "SessionConcepts" ("SportConceptId");

CREATE UNIQUE INDEX "IX_SessionConcepts_TrainingSessionId_Order" ON "SessionConcepts" ("TrainingSessionId", "Order");

CREATE INDEX "IX_SportConcepts_ConceptCategoryId" ON "SportConcepts" ("ConceptCategoryId");

CREATE INDEX "IX_SportConcepts_ConceptPhaseId" ON "SportConcepts" ("ConceptPhaseId");

CREATE INDEX "IX_SportConcepts_DifficultyLevelId" ON "SportConcepts" ("DifficultyLevelId");

CREATE INDEX "IX_SportConcepts_Name_SportId" ON "SportConcepts" ("Name", "SportId");

CREATE INDEX "IX_SportConcepts_SportId" ON "SportConcepts" ("SportId");

CREATE INDEX "IX_TrainingScheduleDays_CourtId" ON "TrainingScheduleDays" ("CourtId");

CREATE UNIQUE INDEX "IX_TrainingScheduleDays_TrainingScheduleId_DayOfWeek" ON "TrainingScheduleDays" ("TrainingScheduleId", "DayOfWeek");

CREATE INDEX "IX_TrainingSchedules_TeamId" ON "TrainingSchedules" ("TeamId");

CREATE INDEX "IX_TrainingSessions_CourtId" ON "TrainingSessions" ("CourtId");

CREATE INDEX "IX_TrainingSessions_TrainingScheduleId" ON "TrainingSessions" ("TrainingScheduleId");

INSERT INTO "ConceptPhases" ("Id", "Name", "Description", "IsActive")
VALUES (1, 'Offense', 'Offensive concepts', TRUE);
INSERT INTO "ConceptPhases" ("Id", "Name", "Description", "IsActive")
VALUES (2, 'Defense', 'Defensive concepts', TRUE);
INSERT INTO "ConceptPhases" ("Id", "Name", "Description", "IsActive")
VALUES (3, 'Both', 'Applicable to both offense and defense', TRUE);

INSERT INTO "DifficultyLevels" ("Id", "Name", "Rank", "IsActive")
VALUES (1, 'Beginner', 1, TRUE);
INSERT INTO "DifficultyLevels" ("Id", "Name", "Rank", "IsActive")
VALUES (2, 'Easy', 2, TRUE);
INSERT INTO "DifficultyLevels" ("Id", "Name", "Rank", "IsActive")
VALUES (3, 'Medium', 3, TRUE);
INSERT INTO "DifficultyLevels" ("Id", "Name", "Rank", "IsActive")
VALUES (4, 'Hard', 4, TRUE);
INSERT INTO "DifficultyLevels" ("Id", "Name", "Rank", "IsActive")
VALUES (5, 'Expert', 5, TRUE);

SELECT setval(
    pg_get_serial_sequence('"ConceptPhases"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "ConceptPhases") + 1,
        nextval(pg_get_serial_sequence('"ConceptPhases"', 'Id'))),
    false);
SELECT setval(
    pg_get_serial_sequence('"DifficultyLevels"', 'Id'),
    GREATEST(
        (SELECT MAX("Id") FROM "DifficultyLevels") + 1,
        nextval(pg_get_serial_sequence('"DifficultyLevels"', 'Id'))),
    false);

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251116005847_AddTrainingPlanning', '9.0.0');

ALTER TABLE "Teams" ADD "TeamCategoryId" integer;

ALTER TABLE "Teams" ADD "TeamLevelId" integer;

CREATE TABLE "TeamCategories" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "MinAge" integer,
    "MaxAge" integer,
    "Description" text,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_TeamCategories" PRIMARY KEY ("Id")
);

CREATE TABLE "TeamLevels" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Rank" integer NOT NULL,
    "Description" text,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_TeamLevels" PRIMARY KEY ("Id")
);

CREATE TABLE "TeamPreferences" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TeamId" integer NOT NULL,
    "PreferencesJson" text,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_TeamPreferences" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TeamPreferences_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE
);

CREATE TABLE "ConceptInterpretations" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "SportConceptId" integer NOT NULL,
    "TeamId" integer,
    "TeamCategoryId" integer,
    "TeamLevelId" integer,
    "InterpretedDifficultyLevelId" integer,
    "DurationMultiplier" numeric NOT NULL,
    "PriorityMultiplier" numeric NOT NULL,
    "IsSuggested" boolean NOT NULL,
    "Notes" text,
    CONSTRAINT "PK_ConceptInterpretations" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ConceptInterpretations_DifficultyLevels_InterpretedDifficul~" FOREIGN KEY ("InterpretedDifficultyLevelId") REFERENCES "DifficultyLevels" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_ConceptInterpretations_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ConceptInterpretations_TeamCategories_TeamCategoryId" FOREIGN KEY ("TeamCategoryId") REFERENCES "TeamCategories" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ConceptInterpretations_TeamLevels_TeamLevelId" FOREIGN KEY ("TeamLevelId") REFERENCES "TeamLevels" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ConceptInterpretations_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_Teams_TeamCategoryId" ON "Teams" ("TeamCategoryId");

CREATE INDEX "IX_Teams_TeamLevelId" ON "Teams" ("TeamLevelId");

CREATE INDEX "IX_ConceptInterpretations_InterpretedDifficultyLevelId" ON "ConceptInterpretations" ("InterpretedDifficultyLevelId");

CREATE INDEX "IX_ConceptInterpretations_SportConceptId" ON "ConceptInterpretations" ("SportConceptId");

CREATE INDEX "IX_ConceptInterpretations_TeamCategoryId" ON "ConceptInterpretations" ("TeamCategoryId");

CREATE INDEX "IX_ConceptInterpretations_TeamId" ON "ConceptInterpretations" ("TeamId");

CREATE INDEX "IX_ConceptInterpretations_TeamLevelId" ON "ConceptInterpretations" ("TeamLevelId");

CREATE UNIQUE INDEX "IX_TeamPreferences_TeamId" ON "TeamPreferences" ("TeamId");

ALTER TABLE "Teams" ADD CONSTRAINT "FK_Teams_TeamCategories_TeamCategoryId" FOREIGN KEY ("TeamCategoryId") REFERENCES "TeamCategories" ("Id");

ALTER TABLE "Teams" ADD CONSTRAINT "FK_Teams_TeamLevels_TeamLevelId" FOREIGN KEY ("TeamLevelId") REFERENCES "TeamLevels" ("Id");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251116012100_AddConceptInterpretation', '9.0.0');


                INSERT INTO "Users" ("SupabaseId", "Email", "Name", "CreatedAt")
                VALUES ('43ccbcfc-5fc1-47b4-a9ce-bd8ed0356c75', 'demo@example.com', 'Demo User', now())
                ON CONFLICT ("SupabaseId") DO NOTHING;
            


                INSERT INTO "Sports" ("Id", "Name", "Slug", "Description", "IsActive", "CreatedAt", "UpdatedAt")
                VALUES (101, 'DemoSport', 'demo-sport', 'Demo sport used by local seed data', TRUE, now(), now())
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "SubscriptionPlans" ("Id","Name","Level","Price","MaxTeams","MaxMembersPerTeam","Features","IsActive","CreatedAt","UpdatedAt")
                VALUES (101,'Demo Plan',0,0,10,25,'Demo plan for seeded data',TRUE, now(), now())
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "Subscriptions" ("Id","UserSupabaseId","OrganizationId","PlanId","SportId","StartDate","EndDate","IsActive","Status","AutoRenew","CreatedAt","UpdatedAt")
                VALUES (101,'43ccbcfc-5fc1-47b4-a9ce-bd8ed0356c75',NULL,101,101,now(),NULL,TRUE,1,FALSE, now(), now())
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "TeamCategories" ("Id","Name","MinAge","MaxAge","Description","IsActive")
                VALUES (101,'U12',10,12,'Under 12 demo category',TRUE)
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "TeamLevels" ("Id","Name","Rank","Description","IsActive")
                VALUES (101,'A',3,'Top demo level A',TRUE)
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "Teams" ("Id","Name","OwnerUserSupabaseId","OrganizationId","SubscriptionId","SportId","TeamCategoryId","TeamLevelId","IsActive","CreatedAt","UpdatedAt")
                VALUES (101,'Demo Team','43ccbcfc-5fc1-47b4-a9ce-bd8ed0356c75',NULL,101,101,101,101,TRUE,now(),now())
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "ConceptCategories" ("Id","Name","Description","IsActive")
                VALUES (101,'Technical','Technical skills like passing and dribbling',TRUE)
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "SportConcepts" ("Id","Name","Description","ConceptCategoryId","ConceptPhaseId","DifficultyLevelId","ProgressWeight","IsProgressive","SportId","IsActive") VALUES
                (101,'Passing','Short and long passing accuracy',101,1,2,60,TRUE,101,TRUE),
                (102,'Shooting','Shooting at goal',101,1,3,70,TRUE,101,TRUE),
                (103,'Ball Control','First touch and ball control',101,3,2,50,TRUE,101,TRUE)
                ON CONFLICT ("Id") DO NOTHING;
            


                INSERT INTO "ConceptInterpretations" ("Id","SportConceptId","TeamId","TeamCategoryId","TeamLevelId","InterpretedDifficultyLevelId","DurationMultiplier","PriorityMultiplier","IsSuggested","Notes") VALUES
                (101,101,NULL,101,NULL,2,1.0,1.2,TRUE,'U12 should focus slightly more on passing (priority x1.2).'),
                (102,102,NULL,101,NULL,3,1.0,1.1,TRUE,'U12 should train shooting; lower priority than passing for this age.'),
                (103,103,NULL,NULL,101,2,1.0,1.3,TRUE,'Level A teams should prioritize ball control.')
                ON CONFLICT ("Id") DO NOTHING;
            

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251116063733_AddDemoTeamData', '9.0.0');

ALTER TABLE "ConceptCategories" ADD "ParentId" integer;

CREATE INDEX "IX_ConceptCategories_ParentId" ON "ConceptCategories" ("ParentId");

ALTER TABLE "ConceptCategories" ADD CONSTRAINT "FK_ConceptCategories_ConceptCategories_ParentId" FOREIGN KEY ("ParentId") REFERENCES "ConceptCategories" ("Id") ON DELETE RESTRICT;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251122204812_AddConceptCategoryHierarchy', '9.0.0');

ALTER TABLE "SportConcepts" DROP CONSTRAINT "FK_SportConcepts_ConceptPhases_ConceptPhaseId";

DROP INDEX "IX_SportConcepts_ConceptPhaseId";

ALTER TABLE "SportConcepts" DROP COLUMN "ConceptPhaseId";

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251122211335_RemoveConceptPhaseFromSportConcept', '9.0.0');

DROP TABLE "ConceptPhases";

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251122211955_DropConceptPhasesTable', '9.0.0');

DROP TABLE "ConceptInterpretations";

DROP TABLE "SessionConcepts";

DROP TABLE "TeamPreferences";

DROP TABLE "TrainingSessions";

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251122214724_UpdateModels', '9.0.0');

ALTER TABLE "SportConcepts" DROP COLUMN "IsProgressive";

ALTER TABLE "SportConcepts" DROP COLUMN "ProgressWeight";

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251122215938_UpdateDatabase', '9.0.0');

ALTER TABLE "PlanConcepts" DROP CONSTRAINT "FK_PlanConcepts_TrainingSchedules_TrainingScheduleId";

ALTER TABLE "TrainingScheduleDays" DROP CONSTRAINT "FK_TrainingScheduleDays_TrainingSchedules_TrainingScheduleId";

ALTER TABLE "TrainingSchedules" DROP CONSTRAINT "FK_TrainingSchedules_Teams_TeamId";

ALTER TABLE "TrainingSchedules" DROP CONSTRAINT "PK_TrainingSchedules";

ALTER TABLE "TrainingSchedules" RENAME TO "Plannings";

ALTER TABLE "TrainingScheduleDays" RENAME COLUMN "TrainingScheduleId" TO "PlanningId";

ALTER INDEX "IX_TrainingScheduleDays_TrainingScheduleId_DayOfWeek" RENAME TO "IX_TrainingScheduleDays_PlanningId_DayOfWeek";

ALTER TABLE "PlanConcepts" RENAME COLUMN "TrainingScheduleId" TO "PlanningId";

ALTER INDEX "IX_PlanConcepts_TrainingScheduleId_SportConceptId" RENAME TO "IX_PlanConcepts_PlanningId_SportConceptId";

ALTER INDEX "IX_TrainingSchedules_TeamId" RENAME TO "IX_Plannings_TeamId";

ALTER TABLE "Plannings" ADD CONSTRAINT "PK_Plannings" PRIMARY KEY ("Id");

ALTER TABLE "PlanConcepts" ADD CONSTRAINT "FK_PlanConcepts_Plannings_PlanningId" FOREIGN KEY ("PlanningId") REFERENCES "Plannings" ("Id") ON DELETE CASCADE;

ALTER TABLE "Plannings" ADD CONSTRAINT "FK_Plannings_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE;

ALTER TABLE "TrainingScheduleDays" ADD CONSTRAINT "FK_TrainingScheduleDays_Plannings_PlanningId" FOREIGN KEY ("PlanningId") REFERENCES "Plannings" ("Id") ON DELETE CASCADE;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251122235653_UpdatePlanningEntity', '9.0.0');

ALTER TABLE "SportConcepts" ADD "Url" text;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251126184445_AddUrlToSportConcept', '9.0.0');

ALTER TABLE "SportConcepts" DROP CONSTRAINT "FK_SportConcepts_DifficultyLevels_DifficultyLevelId";

DROP INDEX "IX_SportConcepts_DifficultyLevelId";

ALTER TABLE "SportConcepts" DROP COLUMN "DifficultyLevelId";

ALTER TABLE "Teams" ADD "CurrentTacticalLevel" integer NOT NULL DEFAULT 0;

ALTER TABLE "Teams" ADD "CurrentTechnicalLevel" integer NOT NULL DEFAULT 0;

ALTER TABLE "SportConcepts" ADD "TacticalComplexity" integer NOT NULL DEFAULT 0;

ALTER TABLE "SportConcepts" ADD "TechnicalDifficulty" integer NOT NULL DEFAULT 0;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251129060928_AddProficiencyLevelsToTeamAndConcept', '9.0.0');

ALTER TABLE "SportConcepts" ADD "DevelopmentLevel" text;

ALTER TABLE "SportConcepts" ADD "TechnicalTacticalFocus" text;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251130142009_AddFocusAndLevelToSportConcept', '9.0.0');

ALTER TABLE "SportConcepts" ADD "ConceptTemplateId" integer;

CREATE TABLE "ConceptTemplates" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "TechnicalComplexity" integer NOT NULL,
    "TacticalComplexity" integer NOT NULL,
    "ConceptCategoryId" integer,
    "SportId" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_ConceptTemplates" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ConceptTemplates_ConceptCategories_ConceptCategoryId" FOREIGN KEY ("ConceptCategoryId") REFERENCES "ConceptCategories" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_ConceptTemplates_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id") ON DELETE RESTRICT
);

CREATE INDEX "IX_SportConcepts_ConceptTemplateId" ON "SportConcepts" ("ConceptTemplateId");

CREATE INDEX "IX_ConceptTemplates_ConceptCategoryId" ON "ConceptTemplates" ("ConceptCategoryId");

CREATE UNIQUE INDEX "IX_ConceptTemplates_Name_SportId" ON "ConceptTemplates" ("Name", "SportId");

CREATE INDEX "IX_ConceptTemplates_SportId" ON "ConceptTemplates" ("SportId");

ALTER TABLE "SportConcepts" ADD CONSTRAINT "FK_SportConcepts_ConceptTemplates_ConceptTemplateId" FOREIGN KEY ("ConceptTemplateId") REFERENCES "ConceptTemplates" ("Id") ON DELETE SET NULL;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251214215306_AddConceptTemplates', '9.0.0');

CREATE TABLE "MethodologicalItineraries" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Code" text NOT NULL,
    "Level" integer NOT NULL,
    "ParentItineraryId" integer,
    "TeamCategoryId" integer,
    "Description" text,
    "IsActive" boolean NOT NULL,
    CONSTRAINT "PK_MethodologicalItineraries" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_ParentI~" FOREIGN KEY ("ParentItineraryId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_MethodologicalItineraries_TeamCategories_TeamCategoryId" FOREIGN KEY ("TeamCategoryId") REFERENCES "TeamCategories" ("Id") ON DELETE SET NULL
);

CREATE UNIQUE INDEX "IX_MethodologicalItineraries_Code" ON "MethodologicalItineraries" ("Code");

CREATE INDEX "IX_MethodologicalItineraries_ParentItineraryId" ON "MethodologicalItineraries" ("ParentItineraryId");

CREATE INDEX "IX_MethodologicalItineraries_TeamCategoryId" ON "MethodologicalItineraries" ("TeamCategoryId");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251220224743_AddMethodologicalItinerary', '9.0.0');

ALTER TABLE "TeamCategories" ADD "SportId" integer;

UPDATE "TeamCategories" SET "SportId" = (SELECT "Id" FROM "Sports" LIMIT 1)

UPDATE "TeamCategories" SET "SportId" = 0 WHERE "SportId" IS NULL;
ALTER TABLE "TeamCategories" ALTER COLUMN "SportId" SET NOT NULL;
ALTER TABLE "TeamCategories" ALTER COLUMN "SportId" SET DEFAULT 0;

CREATE INDEX "IX_TeamCategories_SportId" ON "TeamCategories" ("SportId");

ALTER TABLE "TeamCategories" ADD CONSTRAINT "FK_TeamCategories_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id") ON DELETE CASCADE;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251220233253_AddSportToTeamCategory', '9.0.0');

ALTER TABLE "SportConcepts" ADD "MethodologicalItineraryId" integer;

CREATE INDEX "IX_SportConcepts_MethodologicalItineraryId" ON "SportConcepts" ("MethodologicalItineraryId");

ALTER TABLE "SportConcepts" ADD CONSTRAINT "FK_SportConcepts_MethodologicalItineraries_MethodologicalItine~" FOREIGN KEY ("MethodologicalItineraryId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE SET NULL;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251220234029_LinkConceptsToItinerary', '9.0.0');

ALTER TABLE "SportConcepts" DROP CONSTRAINT "FK_SportConcepts_ConceptTemplates_ConceptTemplateId";

DROP TABLE "ConceptTemplates";

DROP INDEX "IX_SportConcepts_ConceptTemplateId";

ALTER TABLE "SportConcepts" DROP COLUMN "ConceptTemplateId";

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251221001641_RemoveConceptTemplates', '9.0.0');

ALTER TABLE "SportConcepts" ALTER COLUMN "TechnicalTacticalFocus" TYPE integer;

ALTER TABLE "SportConcepts" ALTER COLUMN "DevelopmentLevel" TYPE integer;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251221070837_FixSportConceptTypes', '9.0.0');

CREATE TABLE "Exercises" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "MediaUrl" text,
    "IsActive" boolean NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Exercises" PRIMARY KEY ("Id")
);

CREATE TABLE "TrainingSessions" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text,
    "TeamId" integer NOT NULL,
    "Date" timestamp with time zone NOT NULL,
    "StartTime" interval,
    "Duration" interval,
    "CourtId" integer,
    "CreatedAt" timestamp with time zone NOT NULL,
    "UpdatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_TrainingSessions" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TrainingSessions_Courts_CourtId" FOREIGN KEY ("CourtId") REFERENCES "Courts" ("Id"),
    CONSTRAINT "FK_TrainingSessions_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE
);

CREATE TABLE "ExerciseConcepts" (
    "ConceptsId" integer NOT NULL,
    "ExercisesId" integer NOT NULL,
    CONSTRAINT "PK_ExerciseConcepts" PRIMARY KEY ("ConceptsId", "ExercisesId"),
    CONSTRAINT "FK_ExerciseConcepts_Exercises_ExercisesId" FOREIGN KEY ("ExercisesId") REFERENCES "Exercises" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ExerciseConcepts_SportConcepts_ConceptsId" FOREIGN KEY ("ConceptsId") REFERENCES "SportConcepts" ("Id") ON DELETE CASCADE
);

CREATE TABLE "TrainingSessionConcepts" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TrainingSessionId" integer NOT NULL,
    "SportConceptId" integer NOT NULL,
    "Order" integer NOT NULL,
    CONSTRAINT "PK_TrainingSessionConcepts" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TrainingSessionConcepts_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_TrainingSessionConcepts_TrainingSessions_TrainingSessionId" FOREIGN KEY ("TrainingSessionId") REFERENCES "TrainingSessions" ("Id") ON DELETE CASCADE
);

CREATE TABLE "TrainingSessionExercises" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TrainingSessionId" integer NOT NULL,
    "ExerciseId" integer,
    "CustomText" text,
    "SportConceptId" integer,
    "Order" integer NOT NULL,
    "DurationMinutes" integer,
    CONSTRAINT "PK_TrainingSessionExercises" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TrainingSessionExercises_Exercises_ExerciseId" FOREIGN KEY ("ExerciseId") REFERENCES "Exercises" ("Id"),
    CONSTRAINT "FK_TrainingSessionExercises_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id"),
    CONSTRAINT "FK_TrainingSessionExercises_TrainingSessions_TrainingSessionId" FOREIGN KEY ("TrainingSessionId") REFERENCES "TrainingSessions" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_ExerciseConcepts_ExercisesId" ON "ExerciseConcepts" ("ExercisesId");

CREATE INDEX "IX_TrainingSessionConcepts_SportConceptId" ON "TrainingSessionConcepts" ("SportConceptId");

CREATE INDEX "IX_TrainingSessionConcepts_TrainingSessionId" ON "TrainingSessionConcepts" ("TrainingSessionId");

CREATE INDEX "IX_TrainingSessionExercises_ExerciseId" ON "TrainingSessionExercises" ("ExerciseId");

CREATE INDEX "IX_TrainingSessionExercises_SportConceptId" ON "TrainingSessionExercises" ("SportConceptId");

CREATE INDEX "IX_TrainingSessionExercises_TrainingSessionId" ON "TrainingSessionExercises" ("TrainingSessionId");

CREATE INDEX "IX_TrainingSessions_CourtId" ON "TrainingSessions" ("CourtId");

CREATE INDEX "IX_TrainingSessions_TeamId" ON "TrainingSessions" ("TeamId");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251222075532_AddTrainingAndExercises', '9.0.0');

ALTER TABLE "TrainingSessionConcepts" ADD "DurationMinutes" integer;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251222144435_AddDurationToSessionConcept', '9.0.0');

ALTER TABLE "Exercises" ADD "Tags" text[] NOT NULL;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251222153500_AddTagsToExercises', '9.0.0');

ALTER TABLE "TrainingSessions" ADD "FeedbackNotes" text;

ALTER TABLE "TrainingSessions" ADD "FeedbackRating" integer;

ALTER TABLE "TrainingSessions" ADD "FinishedAt" timestamp with time zone;

ALTER TABLE "TrainingSessions" ADD "StartedAt" timestamp with time zone;

ALTER TABLE "TrainingSessions" ADD "Status" integer NOT NULL DEFAULT 0;

ALTER TABLE "TrainingSessionExercises" ADD "ActualDurationMinutes" integer;

ALTER TABLE "TrainingSessionExercises" ADD "FeedbackNotes" text;

ALTER TABLE "TrainingSessionExercises" ADD "IsCompleted" boolean NOT NULL DEFAULT FALSE;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251222232416_AddTrainingExecutionFields', '9.0.0');

ALTER TABLE "Teams" ADD "SeasonId" integer;

CREATE TABLE "Seasons" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "StartDate" timestamp with time zone NOT NULL,
    "EndDate" timestamp with time zone NOT NULL,
    "IsActive" boolean NOT NULL,
    "OrganizationId" integer,
    CONSTRAINT "PK_Seasons" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Seasons_Organizations_OrganizationId" FOREIGN KEY ("OrganizationId") REFERENCES "Organizations" ("Id")
);

CREATE INDEX "IX_Teams_SeasonId" ON "Teams" ("SeasonId");

CREATE INDEX "IX_Seasons_OrganizationId" ON "Seasons" ("OrganizationId");

ALTER TABLE "Teams" ADD CONSTRAINT "FK_Teams_Seasons_SeasonId" FOREIGN KEY ("SeasonId") REFERENCES "Seasons" ("Id");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251223085359_AddSeasons', '9.0.0');

CREATE TABLE "TeamSeasons" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "TeamId" integer NOT NULL,
    "SeasonId" integer NOT NULL,
    "TeamLevelId" integer,
    "TeamCategoryId" integer,
    "TechnicalLevel" integer NOT NULL,
    "TacticalLevel" integer NOT NULL,
    "PhotoUrl" text,
    CONSTRAINT "PK_TeamSeasons" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_TeamSeasons_Seasons_SeasonId" FOREIGN KEY ("SeasonId") REFERENCES "Seasons" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_TeamSeasons_TeamCategories_TeamCategoryId" FOREIGN KEY ("TeamCategoryId") REFERENCES "TeamCategories" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_TeamSeasons_TeamLevels_TeamLevelId" FOREIGN KEY ("TeamLevelId") REFERENCES "TeamLevels" ("Id"),
    CONSTRAINT "FK_TeamSeasons_Teams_TeamId" FOREIGN KEY ("TeamId") REFERENCES "Teams" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_TeamSeasons_SeasonId" ON "TeamSeasons" ("SeasonId");

CREATE INDEX "IX_TeamSeasons_TeamCategoryId" ON "TeamSeasons" ("TeamCategoryId");

CREATE UNIQUE INDEX "IX_TeamSeasons_TeamId_SeasonId" ON "TeamSeasons" ("TeamId", "SeasonId");

CREATE INDEX "IX_TeamSeasons_TeamLevelId" ON "TeamSeasons" ("TeamLevelId");

ALTER TABLE "Plannings" ADD "SeasonId" integer;

CREATE INDEX "IX_Plannings_SeasonId" ON "Plannings" ("SeasonId");

ALTER TABLE "Plannings" ADD CONSTRAINT "FK_Plannings_Seasons_SeasonId" FOREIGN KEY ("SeasonId") REFERENCES "Seasons" ("Id");

INSERT INTO "TeamSeasons" ("TeamId", "SeasonId", "TeamLevelId", "TechnicalLevel", "TacticalLevel", "TeamCategoryId") 
                  SELECT "Id", "SeasonId", "TeamLevelId", "CurrentTechnicalLevel", "CurrentTacticalLevel", "TeamCategoryId" 
                  FROM "Teams" 
                  WHERE "SeasonId" IS NOT NULL;

UPDATE "Plannings" 
                  SET "SeasonId" = (SELECT "SeasonId" FROM "Teams" WHERE "Teams"."Id" = "Plannings"."TeamId") 
                  WHERE "SeasonId" IS NULL OR "SeasonId" = 0;

ALTER TABLE "MethodologicalItineraries" DROP CONSTRAINT "FK_MethodologicalItineraries_TeamCategories_TeamCategoryId";

ALTER TABLE "Teams" DROP CONSTRAINT "FK_Teams_Seasons_SeasonId";

ALTER TABLE "Teams" DROP CONSTRAINT "FK_Teams_TeamCategories_TeamCategoryId";

ALTER TABLE "Teams" DROP CONSTRAINT "FK_Teams_TeamLevels_TeamLevelId";

DROP INDEX "IX_Teams_SeasonId";

DROP INDEX "IX_Teams_TeamCategoryId";

DROP INDEX "IX_Teams_TeamLevelId";

ALTER TABLE "Teams" DROP COLUMN "CurrentTacticalLevel";

ALTER TABLE "Teams" DROP COLUMN "CurrentTechnicalLevel";

ALTER TABLE "Teams" DROP COLUMN "SeasonId";

ALTER TABLE "Teams" DROP COLUMN "TeamCategoryId";

ALTER TABLE "Teams" DROP COLUMN "TeamLevelId";

ALTER TABLE "MethodologicalItineraries" ADD CONSTRAINT "FK_MethodologicalItineraries_TeamCategories_TeamCategoryId" FOREIGN KEY ("TeamCategoryId") REFERENCES "TeamCategories" ("Id") ON DELETE SET NULL;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251224055916_DecoupleTeamSeason', '9.0.0');

ALTER TABLE "TrainingSessions" ADD "PlanningId" integer;

ALTER TABLE "TrainingSessionConcepts" ADD "OverrideDescription" text;

CREATE INDEX "IX_TrainingSessions_PlanningId" ON "TrainingSessions" ("PlanningId");

ALTER TABLE "TrainingSessions" ADD CONSTRAINT "FK_TrainingSessions_Plannings_PlanningId" FOREIGN KEY ("PlanningId") REFERENCES "Plannings" ("Id");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251224063425_AddPlanningIdToTraining', '9.0.0');

ALTER TABLE "TrainingSessions" ADD "Comments" text[] NOT NULL DEFAULT ('{}');

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251226084916_AddCommentsToTrainingSession', '9.0.0');

ALTER TABLE "SportConcepts" DROP CONSTRAINT "FK_SportConcepts_MethodologicalItineraries_MethodologicalItine~";

ALTER TABLE "MethodologicalItineraries" ADD "AverageRating" double precision NOT NULL DEFAULT 0.0;

ALTER TABLE "MethodologicalItineraries" ADD "IsSystem" boolean NOT NULL DEFAULT FALSE;

ALTER TABLE "MethodologicalItineraries" ADD "OwnerId" text;

ALTER TABLE "MethodologicalItineraries" ADD "RatingCount" integer NOT NULL DEFAULT 0;

ALTER TABLE "MethodologicalItineraries" ADD "SystemSourceId" integer;

ALTER TABLE "MethodologicalItineraries" ADD "Version" integer NOT NULL DEFAULT 0;

CREATE TABLE "ItineraryConcept" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ItineraryId" integer NOT NULL,
    "SportConceptId" integer NOT NULL,
    "CustomDescription" text,
    "Order" integer NOT NULL,
    CONSTRAINT "PK_ItineraryConcept" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ItineraryConcept_MethodologicalItineraries_ItineraryId" FOREIGN KEY ("ItineraryId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_ItineraryConcept_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id") ON DELETE CASCADE
);

CREATE TABLE "ItineraryRatings" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "ItineraryId" integer NOT NULL,
    "UserId" text NOT NULL,
    "Rating" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_ItineraryRatings" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_ItineraryRatings_MethodologicalItineraries_ItineraryId" FOREIGN KEY ("ItineraryId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_MethodologicalItineraries_SystemSourceId" ON "MethodologicalItineraries" ("SystemSourceId");

CREATE INDEX "IX_ItineraryConcept_ItineraryId" ON "ItineraryConcept" ("ItineraryId");

CREATE INDEX "IX_ItineraryConcept_SportConceptId" ON "ItineraryConcept" ("SportConceptId");

CREATE UNIQUE INDEX "IX_ItineraryRatings_ItineraryId_UserId" ON "ItineraryRatings" ("ItineraryId", "UserId");

ALTER TABLE "MethodologicalItineraries" ADD CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_SystemS~" FOREIGN KEY ("SystemSourceId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE RESTRICT;

ALTER TABLE "SportConcepts" ADD CONSTRAINT "FK_SportConcepts_MethodologicalItineraries_MethodologicalItine~" FOREIGN KEY ("MethodologicalItineraryId") REFERENCES "MethodologicalItineraries" ("Id");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251226140332_AddMarketplaceAndRatings', '9.0.0');

ALTER TABLE "MethodologicalItineraries" DROP CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_SystemS~";

ALTER TABLE "MethodologicalItineraries" ADD CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_SystemS~" FOREIGN KEY ("SystemSourceId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE SET NULL;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251226162613_DecoupleItineraryOnDelete', '9.0.0');

ALTER TABLE "ItineraryConcept" DROP CONSTRAINT "FK_ItineraryConcept_MethodologicalItineraries_ItineraryId";

ALTER TABLE "ItineraryConcept" DROP CONSTRAINT "FK_ItineraryConcept_SportConcepts_SportConceptId";

ALTER TABLE "ItineraryRatings" DROP CONSTRAINT "FK_ItineraryRatings_MethodologicalItineraries_ItineraryId";

ALTER TABLE "MethodologicalItineraries" DROP CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_ParentI~";

ALTER TABLE "MethodologicalItineraries" DROP CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_SystemS~";

ALTER TABLE "MethodologicalItineraries" DROP CONSTRAINT "FK_MethodologicalItineraries_TeamCategories_TeamCategoryId";

ALTER TABLE "SportConcepts" DROP CONSTRAINT "FK_SportConcepts_MethodologicalItineraries_MethodologicalItine~";

ALTER TABLE "MethodologicalItineraries" DROP CONSTRAINT "PK_MethodologicalItineraries";

ALTER TABLE "ItineraryRatings" DROP CONSTRAINT "PK_ItineraryRatings";

ALTER TABLE "ItineraryConcept" DROP CONSTRAINT "PK_ItineraryConcept";

ALTER TABLE "MethodologicalItineraries" RENAME TO "PlanningTemplates";

ALTER TABLE "ItineraryRatings" RENAME TO "PlanningTemplateRatings";

ALTER TABLE "ItineraryConcept" RENAME TO "PlanningTemplateConcept";

ALTER TABLE "SportConcepts" RENAME COLUMN "MethodologicalItineraryId" TO "PlanningTemplateId";

ALTER INDEX "IX_SportConcepts_MethodologicalItineraryId" RENAME TO "IX_SportConcepts_PlanningTemplateId";

ALTER TABLE "PlanningTemplates" RENAME COLUMN "ParentItineraryId" TO "ParentTemplateId";

ALTER INDEX "IX_MethodologicalItineraries_TeamCategoryId" RENAME TO "IX_PlanningTemplates_TeamCategoryId";

ALTER INDEX "IX_MethodologicalItineraries_SystemSourceId" RENAME TO "IX_PlanningTemplates_SystemSourceId";

ALTER INDEX "IX_MethodologicalItineraries_ParentItineraryId" RENAME TO "IX_PlanningTemplates_ParentTemplateId";

ALTER INDEX "IX_MethodologicalItineraries_Code" RENAME TO "IX_PlanningTemplates_Code";

ALTER TABLE "PlanningTemplateRatings" RENAME COLUMN "ItineraryId" TO "PlanningTemplateId";

ALTER INDEX "IX_ItineraryRatings_ItineraryId_UserId" RENAME TO "IX_PlanningTemplateRatings_PlanningTemplateId_UserId";

ALTER TABLE "PlanningTemplateConcept" RENAME COLUMN "ItineraryId" TO "PlanningTemplateId";

ALTER INDEX "IX_ItineraryConcept_SportConceptId" RENAME TO "IX_PlanningTemplateConcept_SportConceptId";

ALTER INDEX "IX_ItineraryConcept_ItineraryId" RENAME TO "IX_PlanningTemplateConcept_PlanningTemplateId";

ALTER TABLE "PlanningTemplates" ADD CONSTRAINT "PK_PlanningTemplates" PRIMARY KEY ("Id");

ALTER TABLE "PlanningTemplateRatings" ADD CONSTRAINT "PK_PlanningTemplateRatings" PRIMARY KEY ("Id");

ALTER TABLE "PlanningTemplateConcept" ADD CONSTRAINT "PK_PlanningTemplateConcept" PRIMARY KEY ("Id");

ALTER TABLE "PlanningTemplateConcept" ADD CONSTRAINT "FK_PlanningTemplateConcept_PlanningTemplates_PlanningTemplateId" FOREIGN KEY ("PlanningTemplateId") REFERENCES "PlanningTemplates" ("Id") ON DELETE CASCADE;

ALTER TABLE "PlanningTemplateConcept" ADD CONSTRAINT "FK_PlanningTemplateConcept_SportConcepts_SportConceptId" FOREIGN KEY ("SportConceptId") REFERENCES "SportConcepts" ("Id") ON DELETE CASCADE;

ALTER TABLE "PlanningTemplateRatings" ADD CONSTRAINT "FK_PlanningTemplateRatings_PlanningTemplates_PlanningTemplateId" FOREIGN KEY ("PlanningTemplateId") REFERENCES "PlanningTemplates" ("Id") ON DELETE CASCADE;

ALTER TABLE "PlanningTemplates" ADD CONSTRAINT "FK_PlanningTemplates_PlanningTemplates_ParentTemplateId" FOREIGN KEY ("ParentTemplateId") REFERENCES "PlanningTemplates" ("Id") ON DELETE RESTRICT;

ALTER TABLE "PlanningTemplates" ADD CONSTRAINT "FK_PlanningTemplates_PlanningTemplates_SystemSourceId" FOREIGN KEY ("SystemSourceId") REFERENCES "PlanningTemplates" ("Id") ON DELETE SET NULL;

ALTER TABLE "PlanningTemplates" ADD CONSTRAINT "FK_PlanningTemplates_TeamCategories_TeamCategoryId" FOREIGN KEY ("TeamCategoryId") REFERENCES "TeamCategories" ("Id");

ALTER TABLE "SportConcepts" ADD CONSTRAINT "FK_SportConcepts_PlanningTemplates_PlanningTemplateId" FOREIGN KEY ("PlanningTemplateId") REFERENCES "PlanningTemplates" ("Id");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251226172733_RenameItineraryToPlanningTemplate', '9.0.0');

DROP TABLE "PlanningTemplateRatings";

ALTER TABLE "PlanningTemplates" DROP COLUMN "AverageRating";

ALTER TABLE "PlanningTemplates" DROP COLUMN "RatingCount";

ALTER TABLE "PlanningTemplates" ADD "MethodologicalItineraryId" integer;

CREATE TABLE "MethodologicalItineraries" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "Name" text NOT NULL,
    "Description" text,
    "SportId" integer NOT NULL,
    "IsSystem" boolean NOT NULL,
    "OwnerId" text,
    "Version" integer NOT NULL,
    "AverageRating" double precision NOT NULL,
    "RatingCount" integer NOT NULL,
    "IsActive" boolean NOT NULL,
    "SystemSourceId" integer,
    CONSTRAINT "PK_MethodologicalItineraries" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_MethodologicalItineraries_MethodologicalItineraries_SystemS~" FOREIGN KEY ("SystemSourceId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_MethodologicalItineraries_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id") ON DELETE RESTRICT
);

CREATE TABLE "MethodologicalItineraryRatings" (
    "Id" integer GENERATED BY DEFAULT AS IDENTITY,
    "MethodologicalItineraryId" integer NOT NULL,
    "UserId" text NOT NULL,
    "Rating" integer NOT NULL,
    "CreatedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_MethodologicalItineraryRatings" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_MethodologicalItineraryRatings_MethodologicalItineraries_Me~" FOREIGN KEY ("MethodologicalItineraryId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE CASCADE
);

CREATE INDEX "IX_PlanningTemplates_MethodologicalItineraryId" ON "PlanningTemplates" ("MethodologicalItineraryId");

CREATE INDEX "IX_MethodologicalItineraries_SportId" ON "MethodologicalItineraries" ("SportId");

CREATE INDEX "IX_MethodologicalItineraries_SystemSourceId" ON "MethodologicalItineraries" ("SystemSourceId");

CREATE UNIQUE INDEX "IX_MethodologicalItineraryRatings_MethodologicalItineraryId_Us~" ON "MethodologicalItineraryRatings" ("MethodologicalItineraryId", "UserId");

ALTER TABLE "PlanningTemplates" ADD CONSTRAINT "FK_PlanningTemplates_MethodologicalItineraries_MethodologicalI~" FOREIGN KEY ("MethodologicalItineraryId") REFERENCES "MethodologicalItineraries" ("Id") ON DELETE SET NULL;

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251226175243_AddMarketplaceItineraryStructure', '9.0.0');

ALTER TABLE "SportConcepts" ADD "IsSystem" boolean NOT NULL DEFAULT FALSE;

ALTER TABLE "PlanningTemplates" ALTER COLUMN "Code" DROP NOT NULL;

ALTER TABLE "Exercises" ADD "AuthorName" text;

ALTER TABLE "Exercises" ADD "AverageRating" double precision NOT NULL DEFAULT 0.0;

ALTER TABLE "Exercises" ADD "IsSystem" boolean NOT NULL DEFAULT FALSE;

ALTER TABLE "Exercises" ADD "RatingCount" integer NOT NULL DEFAULT 0;

ALTER TABLE "Exercises" ADD "SportId" integer;

CREATE INDEX "IX_Exercises_SportId" ON "Exercises" ("SportId");

ALTER TABLE "Exercises" ADD CONSTRAINT "FK_Exercises_Sports_SportId" FOREIGN KEY ("SportId") REFERENCES "Sports" ("Id");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251228091034_ActualizarModelo', '9.0.0');

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20251228091131_DummyMigration', '9.0.0');

COMMIT;


