<!-- Compact Header -->
<div class="mb-4 flex justify-between items-center border-b border-dark-border pb-2">
    <div class="flex items-center gap-3">
        <h2 class="text-xl font-black text-white tracking-tight uppercase">MIS EQUIPOS</h2>
        <span class="text-gray-600 text-sm hidden sm:inline-block">|</span>
        <p class="text-gray-500 text-xs sm:text-sm hidden sm:block">Gestiona tus equipos</p>
    </div>
    <button (click)="toggleForm()" *ngIf="!showForm()"
        class="px-3 py-1.5 bg-primary text-black font-bold uppercase text-[10px] tracking-wider hover:bg-white transition-colors flex items-center gap-1 rounded-sm">
        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
            stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        Crear Equipo
    </button>
</div>

<!-- Form Section -->
<!-- Compact Form Section -->
<div *ngIf="showForm()"
    class="mb-6 p-4 bg-dark-surface border border-dark-border animate-in fade-in slide-in-from-top-2 duration-200 shadow-xl">
    <div class="flex items-center justify-between mb-4 border-b border-dark-border pb-2">
        <h3 class="text-sm font-bold text-white flex items-center gap-2 uppercase tracking-wide">
            <span class="w-1 h-4 bg-primary rounded-full"></span>
            {{ editingTeamId() ? 'Editar' : 'Nuevo' }} Equipo
        </h3>
        <button (click)="toggleForm()" class="text-gray-500 hover:text-white transition-colors">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <line x1="18" y1="6" x2="6" y2="18"></line>
                <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
        </button>
    </div>

    <form [formGroup]="teamForm" (ngSubmit)="onSubmit()" class="grid grid-cols-12 gap-x-4 gap-y-3">
        <!-- Name -->
        <div class="col-span-12 md:col-span-4">
            <label class="block text-[10px] font-bold text-gray-400 mb-1 uppercase tracking-wider">NOMBRE</label>
            <input type="text" formControlName="name"
                class="w-full bg-dark-bg border border-dark-border h-9 px-3 rounded text-sm text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all placeholder:text-gray-600"
                placeholder="Nombre del equipo">
        </div>

        <!-- Category -->
        <div class="col-span-6 md:col-span-4">
            <label class="block text-[10px] font-bold text-gray-400 mb-1 uppercase tracking-wider">CATEGORÍA</label>
            <div class="relative">
                <select formControlName="teamCategoryId"
                    class="w-full bg-dark-bg border border-dark-border h-9 px-3 pr-8 rounded appearance-none text-sm text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all cursor-pointer">
                    <option [value]="null">Seleccionar</option>
                    <option *ngFor="let category of teamCategories()" [value]="category.id">
                        {{ category.name }}
                    </option>
                </select>
                <div class="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m6 9 6 6 6-6" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- Level -->
        <div class="col-span-6 md:col-span-4">
            <label class="block text-[10px] font-bold text-gray-400 mb-1 uppercase tracking-wider">NIVEL</label>
            <div class="relative">
                <select formControlName="teamLevelId"
                    class="w-full bg-dark-bg border border-dark-border h-9 px-3 pr-8 rounded appearance-none text-sm text-white focus:border-primary focus:ring-1 focus:ring-primary outline-none transition-all cursor-pointer">
                    <option [value]="null">Seleccionar</option>
                    <option *ngFor="let level of teamLevels()" [value]="level.id">
                        {{ level.name }}
                    </option>
                </select>
                <div class="absolute right-2 top-1/2 -translate-y-1/2 pointer-events-none text-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="m6 9 6 6 6-6" />
                    </svg>
                </div>
            </div>
        </div>

        <!-- Technical Level -->
        <div
            class="col-span-12 md:col-span-6 bg-dark-bg/30 p-2 rounded border border-dark-border/50 flex items-center gap-4">
            <div class="flex-shrink-0 w-24">
                <label class="text-[9px] font-bold text-gray-400 uppercase tracking-wider block">TÉCNICA</label>
                <div class="text-primary font-black text-lg leading-none">{{
                    teamForm.get('currentTechnicalLevel')?.value }}<span
                        class="text-gray-600 text-[9px] font-normal">/10</span></div>
            </div>
            <input type="range" formControlName="currentTechnicalLevel" min="1" max="10" step="1"
                class="w-full h-1.5 bg-dark-border rounded-lg appearance-none cursor-pointer accent-primary hover:accent-primary-light transition-all">
        </div>

        <!-- Tactical Level -->
        <div
            class="col-span-12 md:col-span-6 bg-dark-bg/30 p-2 rounded border border-dark-border/50 flex items-center gap-4">
            <div class="flex-shrink-0 w-24">
                <label class="text-[9px] font-bold text-gray-400 uppercase tracking-wider block">TÁCTICA</label>
                <div class="text-secondary font-black text-lg leading-none">{{
                    teamForm.get('currentTacticalLevel')?.value }}<span
                        class="text-gray-600 text-[9px] font-normal">/10</span></div>
            </div>
            <input type="range" formControlName="currentTacticalLevel" min="1" max="10" step="1"
                class="w-full h-1.5 bg-dark-border rounded-lg appearance-none cursor-pointer accent-secondary hover:accent-secondary-light transition-all">
        </div>

        <!-- Action Button -->
        <div class="col-span-12 flex justify-end mt-2">
            <div class="flex gap-2">
                <button type="button" (click)="toggleForm()"
                    class="px-4 py-2 border border-gray-700 text-gray-400 font-bold uppercase tracking-wider text-xs rounded hover:bg-gray-800 hover:text-white transition-all">
                    Cancelar
                </button>
                <button type="submit" [disabled]="!teamForm.valid || isLoading()"
                    class="px-6 py-2 bg-primary text-black font-bold uppercase tracking-wider text-xs rounded shadow-[0_0_10px_rgba(34,197,94,0.2)] hover:bg-white hover:shadow-[0_0_15px_rgba(255,255,255,0.3)] transition-all disabled:opacity-50 disabled:cursor-not-allowed">
                    {{ isLoading() ? 'GUARDANDO...' : (editingTeamId() ? 'ACTUALIZAR' : 'GUARDAR') }}
                </button>
            </div>
        </div>
    </form>
</div>

<!-- Teams Grid (Only shown when form is hidden) -->
<div *ngIf="!showForm()" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-in fade-in duration-500"
    (click)="closeMenu()">
    <div *ngFor="let team of teams()"
        class="group relative bg-dark-surface border border-dark-border hover:border-gray-500 transition-all duration-300 h-64 rounded-lg overflow-hidden shadow-lg hover:shadow-xl hover:-translate-y-1">

        <!-- Decorative top bar gradient -->
        <div
            class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-primary via-white to-secondary opacity-50 group-hover:opacity-100 transition-opacity">
        </div>

        <!-- Main Content -->
        <div class="p-6 h-full flex flex-col">

            <!-- Header with Team Name and Actions -->
            <div class="flex justify-between items-start mb-4">
                <!-- Team Name -->
                <div class="flex-1 mr-2 overflow-hidden">
                    <h3 class="text-xl font-black text-white tracking-tight truncate" title="{{ team.name }}">
                        {{ team.name }}
                    </h3>
                    <div class="text-xs text-secondary font-bold uppercase tracking-widest mt-0.5">
                        {{ getSportName(team) }}
                    </div>
                </div>

                <!-- Direct Actions Row -->
                <div class="flex items-center gap-1">
                    <!-- Management -->
                    <button (click)="manageTeam(team); $event.stopPropagation()" title="Gestión del Equipo"
                        class="px-3 py-1.5 rounded bg-primary/10 border border-primary/50 text-primary hover:bg-primary hover:text-black transition-all flex items-center gap-1.5 group/btn">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                            <rect x="7" y="7" width="3" height="9" />
                            <rect x="14" y="7" width="3" height="5" />
                        </svg>
                        <span class="text-[10px] font-black uppercase tracking-wider">GESTIÓN</span>
                    </button>

                    <!-- Menu Toggle -->
                    <div class="relative">
                        <button (click)="toggleMenu(team.id, $event)"
                            class="w-8 h-8 rounded bg-dark-bg/50 border border-dark-border text-gray-400 hover:text-white hover:border-gray-500 transition-all flex items-center justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24"
                                fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                stroke-linejoin="round">
                                <circle cx="12" cy="12" r="1"></circle>
                                <circle cx="12" cy="5" r="1"></circle>
                                <circle cx="12" cy="19" r="1"></circle>
                            </svg>
                        </button>

                        <!-- Dropdown Menu -->
                        <div *ngIf="activeMenuId() === team.id" (click)="$event.stopPropagation()"
                            class="absolute right-0 top-full mt-2 w-40 bg-dark-surface border border-dark-border shadow-black/50 shadow-xl rounded z-50 py-1 overflow-hidden animate-in fade-in zoom-in-95 duration-100 origin-top-right">
                            <button (click)="editTeam(team)"
                                class="w-full text-left px-3 py-2 text-xs font-bold text-gray-300 hover:bg-dark-bg hover:text-white transition-colors flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" />
                                </svg>
                                Editar
                            </button>
                            <button (click)="toggleTeamActive(team)"
                                class="w-full text-left px-3 py-2 text-xs font-bold text-gray-300 hover:bg-dark-bg hover:text-white transition-colors flex items-center gap-2">
                                <span [class]="team.isActive ? 'text-red-400' : 'text-emerald-400'">
                                    <svg *ngIf="team.isActive" xmlns="http://www.w3.org/2000/svg" width="12" height="12"
                                        viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="6" y="4" width="4" height="16" />
                                        <rect x="14" y="4" width="4" height="16" />
                                    </svg>
                                    <svg *ngIf="!team.isActive" xmlns="http://www.w3.org/2000/svg" width="12"
                                        height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                        stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polygon points="5 3 19 12 5 21 5 3" />
                                    </svg>
                                </span>
                                {{ team.isActive ? 'Desactivar' : 'Activar' }}
                            </button>
                            <div class="h-px bg-dark-border my-1"></div>
                            <button (click)="deleteTeam(team)"
                                class="w-full text-left px-3 py-2 text-xs font-bold text-red-500 hover:bg-red-500/10 hover:text-red-400 transition-colors flex items-center gap-2">
                                <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <polyline points="3 6 5 6 21 6"></polyline>
                                    <path
                                        d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                    </path>
                                    <line x1="10" y1="11" x2="10" y2="17"></line>
                                    <line x1="14" y1="11" x2="14" y2="17"></line>
                                </svg>
                                Eliminar
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="grid grid-cols-2 gap-3 mt-auto">
                <!-- Category Box -->
                <div
                    class="bg-dark-bg/60 p-2.5 rounded border border-dark-border relative overflow-hidden group/box hover:border-gray-600 transition-colors">
                    <div
                        class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1 group-hover/box:text-gray-400">
                        CATEGORÍA</div>
                    <div class="font-bold text-white text-sm truncate">
                        {{ team.teamCategory?.name || '-' }}
                    </div>
                </div>

                <!-- Level Box -->
                <div
                    class="bg-dark-bg/60 p-2.5 rounded border border-dark-border relative overflow-hidden group/box hover:border-gray-600 transition-colors">
                    <div
                        class="text-[9px] font-black text-gray-500 uppercase tracking-widest mb-1 group-hover/box:text-gray-400">
                        NIVEL</div>
                    <div class="font-bold text-white text-sm truncate">
                        {{ team.teamLevel?.name || '-' }}
                    </div>
                </div>

                <!-- Technical Level Box -->
                <div
                    class="bg-dark-bg/60 p-2.5 rounded border border-dark-border relative overflow-hidden group/box hover:border-primary/50 transition-colors">
                    <div class="text-[9px] font-black text-primary uppercase tracking-widest mb-1">TÉCNICA</div>
                    <div class="flex items-end gap-0.5">
                        <span class="font-bold text-white text-lg leading-none">{{ team.currentTechnicalLevel || '-'
                            }}</span>
                        <span class="text-[10px] text-gray-500 mb-0.5">/10</span>
                    </div>
                    <!-- Mini bar representation -->
                    <div class="w-full h-0.5 bg-dark-surface mt-1.5 rounded-full overflow-hidden">
                        <div class="h-full bg-primary" [style.width.%]="(team.currentTechnicalLevel || 0) * 10"></div>
                    </div>
                </div>

                <!-- Tactical Level Box -->
                <div
                    class="bg-dark-bg/60 p-2.5 rounded border border-dark-border relative overflow-hidden group/box hover:border-secondary/50 transition-colors">
                    <div class="text-[9px] font-black text-secondary uppercase tracking-widest mb-1">TÁCTICA</div>
                    <div class="flex items-end gap-0.5">
                        <span class="font-bold text-white text-lg leading-none">{{ team.currentTacticalLevel || '-'
                            }}</span>
                        <span class="text-[10px] text-gray-500 mb-0.5">/10</span>
                    </div>
                    <!-- Mini bar representation -->
                    <div class="w-full h-0.5 bg-dark-surface mt-1.5 rounded-full overflow-hidden">
                        <div class="h-full bg-secondary" [style.width.%]="(team.currentTacticalLevel || 0) * 10"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Empty State -->
    <div *ngIf="teams().length === 0 && !isLoading()"
        class="col-span-full flex flex-col items-center justify-center py-16 border-2 border-dashed border-dark-border bg-dark-bg/30 rounded-lg">
        <div class="p-4 bg-dark-surface rounded-full mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="text-gray-600">
                <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="9" cy="7" r="4"></circle>
                <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
            </svg>
        </div>
        <p class="text-gray-400 font-bold text-lg">No tienes equipos creados</p>
        <p class="text-gray-600 text-sm mt-2 mb-6">Comienza creando tu primer equipo para gestionar entrenamientos</p>
        <button (click)="toggleForm()"
            class="px-6 py-2 bg-dark-surface border border-primary text-primary font-bold uppercase text-sm hover:bg-primary hover:text-black transition-all">
            Crear mi primer equipo
        </button>
    </div>
</div>

<!-- Delete Confirmation Dialog -->
<app-confirm-dialog [isVisible]="showDeleteDialog()" [isLoading]="isDeletingTeam()"
    title="¿Estás seguro de eliminar este equipo?"
    [message]="teamToDelete() ? 'Estás a punto de eliminar permanentemente el equipo ' + teamToDelete().name + '. Esta acción no se puede deshacer.' : ''"
    confirmText="Eliminar" cancelText="Cancelar" (confirm)="confirmDeleteTeam()" (cancel)="cancelDeleteTeam()"
    (visibilityChange)="showDeleteDialog.set($event)">
</app-confirm-dialog>

<!-- Loading State -->
<div *ngIf="isLoading()" class="flex justify-center items-center py-12">
    <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-primary"></div>
</div>