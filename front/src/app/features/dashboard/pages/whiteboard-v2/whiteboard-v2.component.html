<div class="h-screen w-full bg-[#121212] overflow-hidden flex flex-col relative font-sans">
    
    <!-- Header (Overlay) -->
    <div class="absolute top-0 left-0 right-0 z-50 p-4 pointer-events-none flex justify-between items-start">
        
        <!-- Left: Back & Title -->
        <div class="flex items-center gap-4 pointer-events-auto glass-panel p-2 pr-6 rounded-full animate-in slide-in-from-top duration-300">
            <button (click)="goBack()" class="w-10 h-10 rounded-full flex items-center justify-center hover:bg-white/10 text-white transition-colors">
                <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
                </svg>
            </button>
            <div>
                <input [(ngModel)]="boardName" class="bg-transparent text-white font-bold text-lg outline-none placeholder-white/30 w-64" placeholder="Nombre de la Táctica" />
                <div class="text-xs text-secondary font-medium tracking-widest uppercase">Pizarra Táctica V2</div>
            </div>
        </div>

        <!-- Right: Actions -->
        <div class="flex items-center gap-3 pointer-events-auto glass-panel p-2 rounded-full animate-in slide-in-from-top duration-300 delay-100">
            <button (click)="saveBoard()" [disabled]="isSaving()" class="px-6 py-2 bg-primary text-black font-bold uppercase text-xs tracking-wider rounded-full hover:bg-white transition-all disabled:opacity-50 flex items-center gap-2">
                <div *ngIf="isSaving()" class="w-3 h-3 border-2 border-black border-t-transparent rounded-full animate-spin"></div>
                {{ isSaving() ? 'Guardando...' : 'Guardar' }}
            </button>
        </div>
    </div>

    <!-- Floating Tools (Left) -->
    <div class="absolute left-6 top-1/2 -translate-y-1/2 z-40 pointer-events-auto flex flex-col gap-4 animate-in slide-in-from-left duration-500">
        
        <!-- Tool Palette -->
        <div class="glass-panel p-2 rounded-2xl flex flex-col gap-2">
            <button *ngFor="let tool of [DrawingTool.Select, DrawingTool.Player, DrawingTool.Ball, DrawingTool.Cone]"
                (click)="selectedTool.set(tool)"
                [class.active-tool]="selectedTool() === tool"
                class="tool-btn group relative">
                
                <!-- Icons -->
                <svg *ngIf="tool === DrawingTool.Select" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"/></svg>
                <div *ngIf="tool === DrawingTool.Player" class="w-6 h-6 rounded-full border-2 border-current flex items-center justify-center text-[10px] font-bold">1</div>
                <div *ngIf="tool === DrawingTool.Ball" class="w-5 h-5 rounded-full bg-current"></div>
                <div *ngIf="tool === DrawingTool.Cone" class="w-0 h-0 border-l-[10px] border-l-transparent border-r-[10px] border-r-transparent border-b-[18px] border-b-current"></div>
                
                <!-- Tooltip -->
                <span class="absolute left-full ml-3 px-2 py-1 bg-black text-white text-xs rounded opacity-0 group-hover:opacity-100 transition-opacity whitespace-nowrap pointer-events-none">
                    {{ tool }}
                </span>
            </button>
        </div>

        <!-- Color Palette -->
        <div class="glass-panel p-3 rounded-2xl flex flex-col gap-3 items-center">
            <button *ngFor="let color of ['#FF6B00', '#CCFF00', '#FFFFFF', '#0099FF']"
                (click)="currentColor.set(color)"
                [style.background-color]="color"
                [class.ring-2]="currentColor() === color"
                class="w-6 h-6 rounded-full hover:scale-125 transition-transform ring-white ring-offset-2 ring-offset-[#1A1A1A]">
            </button>
        </div>
    </div>

    <!-- Main Canvas Area -->
    <div class="flex-1 w-full h-full bg-[#1a1a1a] cursor-crosshair">
        <div #stageContainer class="w-full h-full"></div>
    </div>

    <!-- Bottom Timeline (Overlay) -->
    <div class="absolute bottom-6 left-6 right-6 z-40 pointer-events-auto">
        <div class="glass-panel p-4 rounded-xl flex items-center gap-4 animate-in slide-in-from-bottom duration-300">
            
            <!-- Player Controls -->
            <button (click)="playAnimation()" class="w-12 h-12 rounded-full bg-primary text-black flex items-center justify-center hover:scale-110 transition-transform shadow-lg shadow-primary/20">
                <svg *ngIf="!isPlaying()" class="w-6 h-6 fill-current ml-1" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
                <svg *ngIf="isPlaying()" class="w-6 h-6 fill-current" viewBox="0 0 24 24"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
            </button>

            <div class="h-8 w-px bg-white/10 mx-2"></div>

            <!-- Scene Strips -->
            <div class="flex-1 flex items-center gap-3 overflow-x-auto pb-2 scrollbar-hide">
                <div *ngFor="let scene of scenes(); let i = index" 
                     (click)="loadScene(i)"
                     [class.border-primary]="currentSceneIndex() === i"
                     class="relative min-w-[120px] h-20 bg-black/40 rounded-lg border-2 border-transparent hover:border-white/30 cursor-pointer overflow-hidden transition-colors group">
                    
                    <div class="absolute top-2 left-2 text-xs font-bold text-white/50 group-hover:text-white">Escena {{i+1}}</div>
                    <div class="absolute bottom-2 right-2 text-[10px] text-white/30">{{scene.duration/1000}}s</div>
                </div>

                <!-- Add Scene Button -->
                <button (click)="addNewScene()" class="w-20 h-20 rounded-lg border-2 border-dashed border-white/10 hover:border-primary/50 text-white/30 hover:text-primary flex flex-col items-center justify-center gap-1 transition-colors">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                    <span class="text-[10px] uppercase font-bold">Nueva</span>
                </button>
            </div>
        </div>
    </div>

</div>
