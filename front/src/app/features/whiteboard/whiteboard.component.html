<div class="h-full w-full flex flex-col bg-slate-900 overflow-hidden">
  
  <!-- Consolidated Header: Actions + Scenes -->
  <header class="z-30 bg-slate-800/50 backdrop-blur-md border-b border-white/5 p-2 flex items-center gap-4 shadow-xl overflow-hidden min-h-[70px]">
      
      <!-- Actions Section -->
      <div class="flex items-center gap-2 pr-4 border-r border-white/5">
          <button (click)="clearBoard()" 
              class="h-9 px-3 rounded-full bg-red-500/10 text-red-500 flex items-center gap-2 hover:bg-red-500 hover:text-white transition-all shadow-lg border border-red-500/20 group" 
              title="Borrar Escena Actual">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
              <span class="text-[10px] font-bold uppercase hidden group-hover:block">Limpiar Escena</span>
          </button>
          
          <button (click)="resetAll()" 
              class="h-9 px-3 rounded-full bg-slate-700/50 text-gray-400 flex items-center gap-2 hover:bg-red-600 hover:text-white transition-all border border-white/10 group" 
              title="Borrar TODO (Escenas + Pizarra)">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
              <span class="text-[10px] font-bold uppercase hidden group-hover:block">Reset Total</span>
          </button>
      </div>

      <!-- Center: Scenes List (Horizontal Scroll) -->
      <div class="flex-1 min-w-0 flex items-center gap-3 overflow-x-auto custom-scrollbar px-2 py-1">
          <!-- Add Button -->
          <button (click)="addSlide()" class="min-w-[40px] h-10 rounded-lg border-2 border-dashed border-white/20 text-gray-400 hover:text-blue-400 hover:border-blue-400/50 hover:bg-blue-500/10 transition-all flex flex-col items-center justify-center gap-0.5 flex-shrink-0" title="Nueva Escena">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" /></svg>
              <span class="text-[8px] font-bold uppercase">ADD</span>
          </button>

          <!-- Slides -->
          <div class="flex items-center gap-2 flex-shrink-0">
            <div *ngFor="let slide of slides$ | async; let i = index" 
                (click)="loadSlide(slide, i)"
                [class.border-blue-500]="(activeSlideIndex$ | async) === i"
                [class.shadow-[0_0_15px_rgba(59,130,246,0.3)]]="(activeSlideIndex$ | async) === i"
                class="relative h-12 aspect-video bg-slate-700/50 rounded border-2 border-transparent hover:border-blue-500/50 cursor-pointer transition-all flex items-center justify-center overflow-hidden flex-shrink-0 group">
                <span class="text-[8px] font-bold text-gray-400 group-hover:text-blue-400 transition-colors"
                      [class.text-blue-400]="(activeSlideIndex$ | async) === i">
                    ESCENA {{i + 1}}
                </span>
                <span class="absolute bottom-0 right-1 text-[7px] font-bold text-white/30">#{{i + 1}}</span>
                
                <!-- Delete Button -->
                <button (click)="deleteSlide($event, i)" 
                    class="absolute top-0 right-0 w-4 h-4 bg-red-500/80 text-white opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center hover:bg-red-600 rounded-bl">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-2.5 h-2.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" /></svg>
                </button>
            </div>
          </div>
      </div>

      <!-- Right: Playback Controls -->
      <div class="pl-4 border-l border-white/5 flex items-center gap-4">
            <!-- Speed Controls -->
            <div class="flex items-center bg-slate-700/50 rounded-lg p-0.5">
                <button *ngFor="let speed of [1, 1.5, 2]" (click)="setPlaybackSpeed(speed)"
                    [class.bg-slate-600]="playbackSpeed === speed"
                    [class.text-white]="playbackSpeed === speed"
                    [class.text-gray-400]="playbackSpeed !== speed"
                    class="px-2 py-1 rounded text-[10px] font-bold hover:text-white transition-all">
                    {{speed}}x
                </button>
            </div>

            <!-- Loop Controls -->
            <div class="flex items-center gap-2 bg-slate-700/50 rounded-lg px-2 py-1">
                <button (click)="toggleLoop()" 
                    [class.text-blue-400]="isLooping"
                    [class.text-gray-400]="!isLooping"
                    class="hover:text-white transition-all" title="Bucle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" /></svg>
                </button>
                <input *ngIf="isLooping" type="number" [(ngModel)]="loopCount" min="0" 
                    title="0 para infinito"
                    class="w-8 bg-transparent text-[10px] font-bold text-white border-b border-white/20 focus:outline-none text-center">
            </div>

            <button (click)="togglePlayback()" 
                class="w-10 h-10 rounded-full text-white flex items-center justify-center shadow-lg transition-all hover:scale-105"
                [class.bg-blue-600]="!isPlaying"
                [class.bg-red-500]="isPlaying"
                title="{{isPlaying ? 'Detener' : (isLooping ? 'Reproducir en Bucle' : 'Reproducir Una Vez')}}">
                <svg *ngIf="!isPlaying" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M4.5 5.653c0-1.426 1.529-2.33 2.779-1.643l11.54 6.348c1.295.712 1.295 2.573 0 3.285L7.28 19.991c-1.25.687-2.779-.217-2.779-1.643V5.653z" clip-rule="evenodd" />
                </svg>
                <svg *ngIf="isPlaying" xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor">
                    <path fill-rule="evenodd" d="M6.75 5.25a.75.75 0 01.75-.75H9a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H7.5a.75.75 0 01-.75-.75V5.25zm7.5 0A.75.75 0 0115 4.5h1.5a.75.75 0 01.75.75v13.5a.75.75 0 01-.75.75H15a.75.75 0 01-.75-.75V5.25z" clip-rule="evenodd" />
                </svg>
            </button>
      </div>
  </header>

  <!-- Main Area: Canvas -->
  <div class="flex-1 relative overflow-hidden">
      <app-canvas class="absolute inset-0 z-0"></app-canvas>
  </div>

  <!-- Footer Bar -->
  <div class="z-30 bg-slate-900 border-t border-white/5 py-4 flex justify-center items-center shadow-2xl min-h-[70px]">
      <app-toolbar></app-toolbar>
  </div>

</div>
